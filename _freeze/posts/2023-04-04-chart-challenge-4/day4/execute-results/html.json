{
  "hash": "2236c09b2505548ff5a43c1f2e940c3c",
  "result": {
    "markdown": "---\ntitle: \"30 Day Chart Challenge- Endangered Species\"\ndescription: \"How many species have been delisted?\"\ntwitter-card:\n  image: \"thumbnail.png\"\nauthor:\n  - name: Louise E. Sinks\n    url: https://lsinks.github.io/\ndate: 04-03-2023\ncategories: [R, R-code, Code-Along, 30DayChartChallenge] # self-defined categories\ncitation:\n  url: https://lsinks.github.io/posts/2023-04-04-chart-challenge-4/day4\nimage: \"thumbnail.png\"\ndraft: true # setting this to `true` will prevent your post from appearing on your listing page until you're ready!\n---\n\n\nIt is Day 4 of the #30DayChartChallenge. More info can be found at the [challenge's Github page](https://github.com/30DayChartChallenge/Edition2023). Today's theme is history. But this is a subtheme of \"comparisions\", so I'd like to avoid doing a simple time series.\n\nI decided to look at the [endangered species list](https://ecos.fws.gov/ecp/report/species) the US Fish and Wildlife Service maintains. They have a bunch of data spread over multiple tables. I decided to look at the 5 year review data. A 5 year review is the assessment to decide if a species remains list or delisted. The dataset also contains the year the species was first listed. So I'd like to compare how many species have been listed vs. delisted.\n\nThe key to the different listing types is found [here](https://ecos.fws.gov/ecp0/html/db-status.html).\n\n\n::: {.cell}\n\n```{.r .cell-code}\nlibrary(tidyverse)\n```\n\n::: {.cell-output .cell-output-stderr}\n```\n── Attaching core tidyverse packages ──────────────────────── tidyverse 2.0.0 ──\n✔ dplyr     1.1.1     ✔ readr     2.1.4\n✔ forcats   1.0.0     ✔ stringr   1.5.0\n✔ ggplot2   3.4.1     ✔ tibble    3.2.1\n✔ lubridate 1.9.2     ✔ tidyr     1.3.0\n✔ purrr     1.0.1     \n── Conflicts ────────────────────────────────────────── tidyverse_conflicts() ──\n✖ dplyr::filter() masks stats::filter()\n✖ dplyr::lag()    masks stats::lag()\nℹ Use the conflicted package (<http://conflicted.r-lib.org/>) to force all conflicts to become errors\n```\n:::\n\n```{.r .cell-code}\nlibrary(gt)\n#library(rjson)\nlibrary(jsonlite)\n```\n\n::: {.cell-output .cell-output-stderr}\n```\n\nAttaching package: 'jsonlite'\n\nThe following object is masked from 'package:purrr':\n\n    flatten\n```\n:::\n\n```{.r .cell-code}\nlibrary(skimr)\nlibrary(waffle)\n```\n:::\n\n\nToday, I'm was going to load the data directly from the website. I've been downloading it and reading it in from a local folder, but I thought it would be nice to download directly. However, the data uses a \"blob:\" url, which is [not donwloadable directly](https://stackoverflow.com/questions/66609070/is-there-a-way-to-download-file-in-r-from-a-blob-url). There is a [way around this](https://stackoverflow.com/questions/72922306/how-to-download-csv-from-url-starting-with-blobhttps) which might work for some datasets.\n\n\n::: {.cell}\n\n```{.r .cell-code}\n#endangered <- fromJSON(file = #\"https://ecos.fws.gov/ecp/report/speciesFiveYearReview?format=json&_=1680620711873\")\n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\n#json_flat <- flatten(endangered)\n```\n:::\n\n\nLet's build our viz with the csv.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nendangered_df <- read_csv(\"five_year.csv\", show_col_types = FALSE)\n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nendangered_df_sub <- endangered_df %>%\n  select(name = `Common Name`, \n         status = `ESA Listing Status`, \n         date = `Listing Date`,\n         rec = `5YSR Recommendation`)\n```\n:::\n\n\nLet's see what kind of categories we have.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nendangered_df_sub <- endangered_df_sub %>%\n  mutate(status = factor(status), rec = factor(rec))\n```\n:::\n\n\nSkim this bad boy\n\n\n::: {.cell}\n\n```{.r .cell-code}\nskim(endangered_df_sub)\n```\n\n::: {.cell-output-display}\nTable: Data summary\n\n|                         |                  |\n|:------------------------|:-----------------|\n|Name                     |endangered_df_sub |\n|Number of rows           |1533              |\n|Number of columns        |4                 |\n|_______________________  |                  |\n|Column type frequency:   |                  |\n|character                |1                 |\n|factor                   |2                 |\n|numeric                  |1                 |\n|________________________ |                  |\n|Group variables          |None              |\n\n\n**Variable type: character**\n\n|skim_variable | n_missing| complete_rate| min| max| empty| n_unique| whitespace|\n|:-------------|---------:|-------------:|---:|---:|-----:|--------:|----------:|\n|name          |         0|             1|   3|  51|     0|     1159|          0|\n\n\n**Variable type: factor**\n\n|skim_variable | n_missing| complete_rate|ordered | n_unique|top_counts                           |\n|:-------------|---------:|-------------:|:-------|--------:|:------------------------------------|\n|status        |         0|             1|FALSE   |        8|E: 1173, T: 316, DM: 35, DNS: 3      |\n|rec           |         0|             1|FALSE   |        7|No : 1389, Del: 49, Dow: 40, Del: 27 |\n\n\n**Variable type: numeric**\n\n|skim_variable | n_missing| complete_rate|   mean|    sd|   p0|  p25|  p50|  p75| p100|hist  |\n|:-------------|---------:|-------------:|------:|-----:|----:|----:|----:|----:|----:|:-----|\n|date          |         0|             1| 1993.5| 12.47| 1967| 1987| 1993| 1999| 2017|▂▃▇▂▃ |\n:::\n:::\n\n\nrec\n\n\n::: {.cell}\n\n```{.r .cell-code}\nsummary(endangered_df_sub$rec)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n                    Delist: The listed entity does not meet the statutory definition of a species \n                                                                                                8 \nDelist: The species does not meet the definition of an endangered species or a threatened species \n                                                                                               49 \n                                                                   Delist: The species is extinct \n                                                                                               27 \n                                                                                    Downlist to T \n                                                                                               40 \n                                                                              No change in Status \n                                                                                             1389 \n                                                                        Revision of listed entity \n                                                                                                2 \n                                                                                      Uplist to E \n                                                                                               18 \n```\n:::\n:::\n\n\nThe recommendations don't always match the current status. I'm assuming the recommendations will be enacted/adopted eventually, so I am using them as the correct current status.\n\nWe have 7 levels in recommendations. We need to consolidate them. I'm going to combine \"Delist: The listed entity does not meet the statutory definition of a species\" and \"Delist: The species does not meet the definition of an endangered species or a threatened species\" into a level called delisted. The delisting because the species is extinct will be made into a level called extinct later.\n\n\n::: {.cell}\n\n```{.r .cell-code}\n#all delist into one\n\nendangered_df_sub <- endangered_df_sub %>%\n  mutate(condensed = fct_collapse(rec, delisted = c(\"Delist: The listed entity does not meet the statutory definition of a species\",\n    \"Delist: The species does not meet the definition of an endangered species or a threatened species\")\n  ))\n```\n:::\n\n\nI'm going to count both \"Downlist to threatened\" and \"uplist to Endangered\" as endangered. I don't know the original listing level, so it doesn't make too much difference to me.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nendangered_df_sub <- endangered_df_sub %>%\n  mutate(condensed = fct_collapse(condensed, endangered = c(\"Downlist to T\",\n    \"Uplist to E\")  ))\n```\n:::\n\n\nNow, I'm pulling in the status for the entries that have \"No change in Status\" as the recommendation. I'm using a case_when and listing every combination. I could get this done if fewer lines if I used or statements (E or T is endangered), but I left it more granular in case I wanted to come back and change the levels. Maybe later I do care about the different between threatened and endangered and want to break them out separately.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nendangered_df_sub <- endangered_df_sub %>%\n  mutate(condensed = case_when(\n    condensed == \"No change in Status\" & status == \"E\" ~ \"endangered\",\n    condensed == \"No change in Status\" & status == \"T\" ~ \"endangered\",\n    condensed == \"No change in Status\" & status == \"RT\" ~ \"delisted\",\n    condensed == \"No change in Status\" & status == \"D3A\" ~ \"extinct\",\n    condensed == \"No change in Status\" & status == \"DM\" ~ \"delisted\",\n    condensed == \"No change in Status\" & status == \"DP\" ~ \"delisted\",\n    condensed == \"No change in Status\" & status == \"DR\" ~ \"delisted\",\n    condensed == \"No change in Status\" & status == \"DNS\" ~ \"delisted\",\n    condensed != \"No change in Status\" ~ condensed)\n    )\n```\n:::\n\n\nNow I'm going to group my extincts.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nendangered_df_sub <- endangered_df_sub %>%\n  mutate(condensed = \n           fct_collapse(condensed, extinct = \n                          c(\"Delist: The species is extinct\", \"extinct\")))\n```\n\n::: {.cell-output .cell-output-stderr}\n```\nWarning: There was 1 warning in `mutate()`.\nℹ In argument: `condensed = fct_collapse(...)`.\nCaused by warning:\n! Unknown levels in `f`: extinct\n```\n:::\n:::\n\n\nI'm not sure what : Revision of listed entity means. I'm going to see if there are comments back in the full dataset.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nendangered_df %>% \n  filter(`5YSR Recommendation` == \"Revision of listed entity\")\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n# A tibble: 2 × 11\n  `Scientific Name`            `Common Name` `Where Listed` `ESA Listing Status`\n  <chr>                        <chr>         <chr>          <chr>               \n1 Rangifer tarandus ssp. cari… Caribou DPS,… <div>Southern… E                   \n2 Cereus eriophorus var. frag… Prickly-appl… <div></div>    E                   \n# ℹ 7 more variables: `Lead Region` <dbl>, `Listing Date` <dbl>,\n#   `Most Recently Completed 5YSR` <date>, `5YSR Recommendation` <chr>,\n#   `Notice of In Progress 5YSR` <chr>,\n#   `Notice Date of In Progress 5YSR` <date>, Group <chr>\n```\n:::\n:::\n\n\nI'm not seeing any explanation. There is not an entry in the code key either.\n\nOkay, now for a visualization. This actually seems perfect for a waffle. There were 1533 endangered or threatened species.\n\nTry waffling again. I did try a different package (ggwaffle) that also doesn't work. It does let you use a dataframe, but it also doesn't handle large numbers well. It soes let you downsample the data if the numbers are too large, but I'd rather just process the data myself to make it waffle.\n\nSo, first I need to summarize the data to get the counts per class.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nprogress <- endangered_df_sub %>%\n  count(condensed)\n\ngt(progress)\n```\n\n::: {.cell-output-display}\n```{=html}\n<div id=\"vorlexbkrf\" style=\"padding-left:0px;padding-right:0px;padding-top:10px;padding-bottom:10px;overflow-x:auto;overflow-y:auto;width:auto;height:auto;\">\n<style>#vorlexbkrf table {\n  font-family: system-ui, 'Segoe UI', Roboto, Helvetica, Arial, sans-serif, 'Apple Color Emoji', 'Segoe UI Emoji', 'Segoe UI Symbol', 'Noto Color Emoji';\n  -webkit-font-smoothing: antialiased;\n  -moz-osx-font-smoothing: grayscale;\n}\n\n#vorlexbkrf thead, #vorlexbkrf tbody, #vorlexbkrf tfoot, #vorlexbkrf tr, #vorlexbkrf td, #vorlexbkrf th {\n  border-style: none;\n}\n\n#vorlexbkrf p {\n  margin: 0;\n  padding: 0;\n}\n\n#vorlexbkrf .gt_table {\n  display: table;\n  border-collapse: collapse;\n  line-height: normal;\n  margin-left: auto;\n  margin-right: auto;\n  color: #333333;\n  font-size: 16px;\n  font-weight: normal;\n  font-style: normal;\n  background-color: #FFFFFF;\n  width: auto;\n  border-top-style: solid;\n  border-top-width: 2px;\n  border-top-color: #A8A8A8;\n  border-right-style: none;\n  border-right-width: 2px;\n  border-right-color: #D3D3D3;\n  border-bottom-style: solid;\n  border-bottom-width: 2px;\n  border-bottom-color: #A8A8A8;\n  border-left-style: none;\n  border-left-width: 2px;\n  border-left-color: #D3D3D3;\n}\n\n#vorlexbkrf .gt_caption {\n  padding-top: 4px;\n  padding-bottom: 4px;\n}\n\n#vorlexbkrf .gt_title {\n  color: #333333;\n  font-size: 125%;\n  font-weight: initial;\n  padding-top: 4px;\n  padding-bottom: 4px;\n  padding-left: 5px;\n  padding-right: 5px;\n  border-bottom-color: #FFFFFF;\n  border-bottom-width: 0;\n}\n\n#vorlexbkrf .gt_subtitle {\n  color: #333333;\n  font-size: 85%;\n  font-weight: initial;\n  padding-top: 3px;\n  padding-bottom: 5px;\n  padding-left: 5px;\n  padding-right: 5px;\n  border-top-color: #FFFFFF;\n  border-top-width: 0;\n}\n\n#vorlexbkrf .gt_heading {\n  background-color: #FFFFFF;\n  text-align: center;\n  border-bottom-color: #FFFFFF;\n  border-left-style: none;\n  border-left-width: 1px;\n  border-left-color: #D3D3D3;\n  border-right-style: none;\n  border-right-width: 1px;\n  border-right-color: #D3D3D3;\n}\n\n#vorlexbkrf .gt_bottom_border {\n  border-bottom-style: solid;\n  border-bottom-width: 2px;\n  border-bottom-color: #D3D3D3;\n}\n\n#vorlexbkrf .gt_col_headings {\n  border-top-style: solid;\n  border-top-width: 2px;\n  border-top-color: #D3D3D3;\n  border-bottom-style: solid;\n  border-bottom-width: 2px;\n  border-bottom-color: #D3D3D3;\n  border-left-style: none;\n  border-left-width: 1px;\n  border-left-color: #D3D3D3;\n  border-right-style: none;\n  border-right-width: 1px;\n  border-right-color: #D3D3D3;\n}\n\n#vorlexbkrf .gt_col_heading {\n  color: #333333;\n  background-color: #FFFFFF;\n  font-size: 100%;\n  font-weight: normal;\n  text-transform: inherit;\n  border-left-style: none;\n  border-left-width: 1px;\n  border-left-color: #D3D3D3;\n  border-right-style: none;\n  border-right-width: 1px;\n  border-right-color: #D3D3D3;\n  vertical-align: bottom;\n  padding-top: 5px;\n  padding-bottom: 6px;\n  padding-left: 5px;\n  padding-right: 5px;\n  overflow-x: hidden;\n}\n\n#vorlexbkrf .gt_column_spanner_outer {\n  color: #333333;\n  background-color: #FFFFFF;\n  font-size: 100%;\n  font-weight: normal;\n  text-transform: inherit;\n  padding-top: 0;\n  padding-bottom: 0;\n  padding-left: 4px;\n  padding-right: 4px;\n}\n\n#vorlexbkrf .gt_column_spanner_outer:first-child {\n  padding-left: 0;\n}\n\n#vorlexbkrf .gt_column_spanner_outer:last-child {\n  padding-right: 0;\n}\n\n#vorlexbkrf .gt_column_spanner {\n  border-bottom-style: solid;\n  border-bottom-width: 2px;\n  border-bottom-color: #D3D3D3;\n  vertical-align: bottom;\n  padding-top: 5px;\n  padding-bottom: 5px;\n  overflow-x: hidden;\n  display: inline-block;\n  width: 100%;\n}\n\n#vorlexbkrf .gt_spanner_row {\n  border-bottom-style: hidden;\n}\n\n#vorlexbkrf .gt_group_heading {\n  padding-top: 8px;\n  padding-bottom: 8px;\n  padding-left: 5px;\n  padding-right: 5px;\n  color: #333333;\n  background-color: #FFFFFF;\n  font-size: 100%;\n  font-weight: initial;\n  text-transform: inherit;\n  border-top-style: solid;\n  border-top-width: 2px;\n  border-top-color: #D3D3D3;\n  border-bottom-style: solid;\n  border-bottom-width: 2px;\n  border-bottom-color: #D3D3D3;\n  border-left-style: none;\n  border-left-width: 1px;\n  border-left-color: #D3D3D3;\n  border-right-style: none;\n  border-right-width: 1px;\n  border-right-color: #D3D3D3;\n  vertical-align: middle;\n  text-align: left;\n}\n\n#vorlexbkrf .gt_empty_group_heading {\n  padding: 0.5px;\n  color: #333333;\n  background-color: #FFFFFF;\n  font-size: 100%;\n  font-weight: initial;\n  border-top-style: solid;\n  border-top-width: 2px;\n  border-top-color: #D3D3D3;\n  border-bottom-style: solid;\n  border-bottom-width: 2px;\n  border-bottom-color: #D3D3D3;\n  vertical-align: middle;\n}\n\n#vorlexbkrf .gt_from_md > :first-child {\n  margin-top: 0;\n}\n\n#vorlexbkrf .gt_from_md > :last-child {\n  margin-bottom: 0;\n}\n\n#vorlexbkrf .gt_row {\n  padding-top: 8px;\n  padding-bottom: 8px;\n  padding-left: 5px;\n  padding-right: 5px;\n  margin: 10px;\n  border-top-style: solid;\n  border-top-width: 1px;\n  border-top-color: #D3D3D3;\n  border-left-style: none;\n  border-left-width: 1px;\n  border-left-color: #D3D3D3;\n  border-right-style: none;\n  border-right-width: 1px;\n  border-right-color: #D3D3D3;\n  vertical-align: middle;\n  overflow-x: hidden;\n}\n\n#vorlexbkrf .gt_stub {\n  color: #333333;\n  background-color: #FFFFFF;\n  font-size: 100%;\n  font-weight: initial;\n  text-transform: inherit;\n  border-right-style: solid;\n  border-right-width: 2px;\n  border-right-color: #D3D3D3;\n  padding-left: 5px;\n  padding-right: 5px;\n}\n\n#vorlexbkrf .gt_stub_row_group {\n  color: #333333;\n  background-color: #FFFFFF;\n  font-size: 100%;\n  font-weight: initial;\n  text-transform: inherit;\n  border-right-style: solid;\n  border-right-width: 2px;\n  border-right-color: #D3D3D3;\n  padding-left: 5px;\n  padding-right: 5px;\n  vertical-align: top;\n}\n\n#vorlexbkrf .gt_row_group_first td {\n  border-top-width: 2px;\n}\n\n#vorlexbkrf .gt_row_group_first th {\n  border-top-width: 2px;\n}\n\n#vorlexbkrf .gt_summary_row {\n  color: #333333;\n  background-color: #FFFFFF;\n  text-transform: inherit;\n  padding-top: 8px;\n  padding-bottom: 8px;\n  padding-left: 5px;\n  padding-right: 5px;\n}\n\n#vorlexbkrf .gt_first_summary_row {\n  border-top-style: solid;\n  border-top-color: #D3D3D3;\n}\n\n#vorlexbkrf .gt_first_summary_row.thick {\n  border-top-width: 2px;\n}\n\n#vorlexbkrf .gt_last_summary_row {\n  padding-top: 8px;\n  padding-bottom: 8px;\n  padding-left: 5px;\n  padding-right: 5px;\n  border-bottom-style: solid;\n  border-bottom-width: 2px;\n  border-bottom-color: #D3D3D3;\n}\n\n#vorlexbkrf .gt_grand_summary_row {\n  color: #333333;\n  background-color: #FFFFFF;\n  text-transform: inherit;\n  padding-top: 8px;\n  padding-bottom: 8px;\n  padding-left: 5px;\n  padding-right: 5px;\n}\n\n#vorlexbkrf .gt_first_grand_summary_row {\n  padding-top: 8px;\n  padding-bottom: 8px;\n  padding-left: 5px;\n  padding-right: 5px;\n  border-top-style: double;\n  border-top-width: 6px;\n  border-top-color: #D3D3D3;\n}\n\n#vorlexbkrf .gt_last_grand_summary_row_top {\n  padding-top: 8px;\n  padding-bottom: 8px;\n  padding-left: 5px;\n  padding-right: 5px;\n  border-bottom-style: double;\n  border-bottom-width: 6px;\n  border-bottom-color: #D3D3D3;\n}\n\n#vorlexbkrf .gt_striped {\n  background-color: rgba(128, 128, 128, 0.05);\n}\n\n#vorlexbkrf .gt_table_body {\n  border-top-style: solid;\n  border-top-width: 2px;\n  border-top-color: #D3D3D3;\n  border-bottom-style: solid;\n  border-bottom-width: 2px;\n  border-bottom-color: #D3D3D3;\n}\n\n#vorlexbkrf .gt_footnotes {\n  color: #333333;\n  background-color: #FFFFFF;\n  border-bottom-style: none;\n  border-bottom-width: 2px;\n  border-bottom-color: #D3D3D3;\n  border-left-style: none;\n  border-left-width: 2px;\n  border-left-color: #D3D3D3;\n  border-right-style: none;\n  border-right-width: 2px;\n  border-right-color: #D3D3D3;\n}\n\n#vorlexbkrf .gt_footnote {\n  margin: 0px;\n  font-size: 90%;\n  padding-top: 4px;\n  padding-bottom: 4px;\n  padding-left: 5px;\n  padding-right: 5px;\n}\n\n#vorlexbkrf .gt_sourcenotes {\n  color: #333333;\n  background-color: #FFFFFF;\n  border-bottom-style: none;\n  border-bottom-width: 2px;\n  border-bottom-color: #D3D3D3;\n  border-left-style: none;\n  border-left-width: 2px;\n  border-left-color: #D3D3D3;\n  border-right-style: none;\n  border-right-width: 2px;\n  border-right-color: #D3D3D3;\n}\n\n#vorlexbkrf .gt_sourcenote {\n  font-size: 90%;\n  padding-top: 4px;\n  padding-bottom: 4px;\n  padding-left: 5px;\n  padding-right: 5px;\n}\n\n#vorlexbkrf .gt_left {\n  text-align: left;\n}\n\n#vorlexbkrf .gt_center {\n  text-align: center;\n}\n\n#vorlexbkrf .gt_right {\n  text-align: right;\n  font-variant-numeric: tabular-nums;\n}\n\n#vorlexbkrf .gt_font_normal {\n  font-weight: normal;\n}\n\n#vorlexbkrf .gt_font_bold {\n  font-weight: bold;\n}\n\n#vorlexbkrf .gt_font_italic {\n  font-style: italic;\n}\n\n#vorlexbkrf .gt_super {\n  font-size: 65%;\n}\n\n#vorlexbkrf .gt_footnote_marks {\n  font-size: 75%;\n  vertical-align: 0.4em;\n  position: initial;\n}\n\n#vorlexbkrf .gt_asterisk {\n  font-size: 100%;\n  vertical-align: 0;\n}\n\n#vorlexbkrf .gt_indent_1 {\n  text-indent: 5px;\n}\n\n#vorlexbkrf .gt_indent_2 {\n  text-indent: 10px;\n}\n\n#vorlexbkrf .gt_indent_3 {\n  text-indent: 15px;\n}\n\n#vorlexbkrf .gt_indent_4 {\n  text-indent: 20px;\n}\n\n#vorlexbkrf .gt_indent_5 {\n  text-indent: 25px;\n}\n</style>\n<table class=\"gt_table\" data-quarto-disable-processing=\"false\" data-quarto-bootstrap=\"false\">\n  <thead>\n    \n    <tr class=\"gt_col_headings\">\n      <th class=\"gt_col_heading gt_columns_bottom_border gt_center\" rowspan=\"1\" colspan=\"1\" scope=\"col\" id=\"condensed\">condensed</th>\n      <th class=\"gt_col_heading gt_columns_bottom_border gt_right\" rowspan=\"1\" colspan=\"1\" scope=\"col\" id=\"n\">n</th>\n    </tr>\n  </thead>\n  <tbody class=\"gt_table_body\">\n    <tr><td headers=\"condensed\" class=\"gt_row gt_center\">extinct</td>\n<td headers=\"n\" class=\"gt_row gt_right\">27</td></tr>\n    <tr><td headers=\"condensed\" class=\"gt_row gt_center\">delisted</td>\n<td headers=\"n\" class=\"gt_row gt_right\">64</td></tr>\n    <tr><td headers=\"condensed\" class=\"gt_row gt_center\">endangered</td>\n<td headers=\"n\" class=\"gt_row gt_right\">1440</td></tr>\n    <tr><td headers=\"condensed\" class=\"gt_row gt_center\">Revision of listed entity</td>\n<td headers=\"n\" class=\"gt_row gt_right\">2</td></tr>\n  </tbody>\n  \n  \n</table>\n</div>\n```\n:::\n:::\n\n\nNow let's change to percentages for optimal waffling\n\n\n::: {.cell}\n\n```{.r .cell-code}\nnum_species <- nrow(endangered_df_sub)\nprogress_percent <- progress %>%\n  mutate(n = ( n/num_species) * 100)\n\nprogress_percent <- progress_percent %>%\n  mutate(n = round(n,1))\n\ngt(progress_percent)\n```\n\n::: {.cell-output-display}\n```{=html}\n<div id=\"kposcyxavu\" style=\"padding-left:0px;padding-right:0px;padding-top:10px;padding-bottom:10px;overflow-x:auto;overflow-y:auto;width:auto;height:auto;\">\n<style>#kposcyxavu table {\n  font-family: system-ui, 'Segoe UI', Roboto, Helvetica, Arial, sans-serif, 'Apple Color Emoji', 'Segoe UI Emoji', 'Segoe UI Symbol', 'Noto Color Emoji';\n  -webkit-font-smoothing: antialiased;\n  -moz-osx-font-smoothing: grayscale;\n}\n\n#kposcyxavu thead, #kposcyxavu tbody, #kposcyxavu tfoot, #kposcyxavu tr, #kposcyxavu td, #kposcyxavu th {\n  border-style: none;\n}\n\n#kposcyxavu p {\n  margin: 0;\n  padding: 0;\n}\n\n#kposcyxavu .gt_table {\n  display: table;\n  border-collapse: collapse;\n  line-height: normal;\n  margin-left: auto;\n  margin-right: auto;\n  color: #333333;\n  font-size: 16px;\n  font-weight: normal;\n  font-style: normal;\n  background-color: #FFFFFF;\n  width: auto;\n  border-top-style: solid;\n  border-top-width: 2px;\n  border-top-color: #A8A8A8;\n  border-right-style: none;\n  border-right-width: 2px;\n  border-right-color: #D3D3D3;\n  border-bottom-style: solid;\n  border-bottom-width: 2px;\n  border-bottom-color: #A8A8A8;\n  border-left-style: none;\n  border-left-width: 2px;\n  border-left-color: #D3D3D3;\n}\n\n#kposcyxavu .gt_caption {\n  padding-top: 4px;\n  padding-bottom: 4px;\n}\n\n#kposcyxavu .gt_title {\n  color: #333333;\n  font-size: 125%;\n  font-weight: initial;\n  padding-top: 4px;\n  padding-bottom: 4px;\n  padding-left: 5px;\n  padding-right: 5px;\n  border-bottom-color: #FFFFFF;\n  border-bottom-width: 0;\n}\n\n#kposcyxavu .gt_subtitle {\n  color: #333333;\n  font-size: 85%;\n  font-weight: initial;\n  padding-top: 3px;\n  padding-bottom: 5px;\n  padding-left: 5px;\n  padding-right: 5px;\n  border-top-color: #FFFFFF;\n  border-top-width: 0;\n}\n\n#kposcyxavu .gt_heading {\n  background-color: #FFFFFF;\n  text-align: center;\n  border-bottom-color: #FFFFFF;\n  border-left-style: none;\n  border-left-width: 1px;\n  border-left-color: #D3D3D3;\n  border-right-style: none;\n  border-right-width: 1px;\n  border-right-color: #D3D3D3;\n}\n\n#kposcyxavu .gt_bottom_border {\n  border-bottom-style: solid;\n  border-bottom-width: 2px;\n  border-bottom-color: #D3D3D3;\n}\n\n#kposcyxavu .gt_col_headings {\n  border-top-style: solid;\n  border-top-width: 2px;\n  border-top-color: #D3D3D3;\n  border-bottom-style: solid;\n  border-bottom-width: 2px;\n  border-bottom-color: #D3D3D3;\n  border-left-style: none;\n  border-left-width: 1px;\n  border-left-color: #D3D3D3;\n  border-right-style: none;\n  border-right-width: 1px;\n  border-right-color: #D3D3D3;\n}\n\n#kposcyxavu .gt_col_heading {\n  color: #333333;\n  background-color: #FFFFFF;\n  font-size: 100%;\n  font-weight: normal;\n  text-transform: inherit;\n  border-left-style: none;\n  border-left-width: 1px;\n  border-left-color: #D3D3D3;\n  border-right-style: none;\n  border-right-width: 1px;\n  border-right-color: #D3D3D3;\n  vertical-align: bottom;\n  padding-top: 5px;\n  padding-bottom: 6px;\n  padding-left: 5px;\n  padding-right: 5px;\n  overflow-x: hidden;\n}\n\n#kposcyxavu .gt_column_spanner_outer {\n  color: #333333;\n  background-color: #FFFFFF;\n  font-size: 100%;\n  font-weight: normal;\n  text-transform: inherit;\n  padding-top: 0;\n  padding-bottom: 0;\n  padding-left: 4px;\n  padding-right: 4px;\n}\n\n#kposcyxavu .gt_column_spanner_outer:first-child {\n  padding-left: 0;\n}\n\n#kposcyxavu .gt_column_spanner_outer:last-child {\n  padding-right: 0;\n}\n\n#kposcyxavu .gt_column_spanner {\n  border-bottom-style: solid;\n  border-bottom-width: 2px;\n  border-bottom-color: #D3D3D3;\n  vertical-align: bottom;\n  padding-top: 5px;\n  padding-bottom: 5px;\n  overflow-x: hidden;\n  display: inline-block;\n  width: 100%;\n}\n\n#kposcyxavu .gt_spanner_row {\n  border-bottom-style: hidden;\n}\n\n#kposcyxavu .gt_group_heading {\n  padding-top: 8px;\n  padding-bottom: 8px;\n  padding-left: 5px;\n  padding-right: 5px;\n  color: #333333;\n  background-color: #FFFFFF;\n  font-size: 100%;\n  font-weight: initial;\n  text-transform: inherit;\n  border-top-style: solid;\n  border-top-width: 2px;\n  border-top-color: #D3D3D3;\n  border-bottom-style: solid;\n  border-bottom-width: 2px;\n  border-bottom-color: #D3D3D3;\n  border-left-style: none;\n  border-left-width: 1px;\n  border-left-color: #D3D3D3;\n  border-right-style: none;\n  border-right-width: 1px;\n  border-right-color: #D3D3D3;\n  vertical-align: middle;\n  text-align: left;\n}\n\n#kposcyxavu .gt_empty_group_heading {\n  padding: 0.5px;\n  color: #333333;\n  background-color: #FFFFFF;\n  font-size: 100%;\n  font-weight: initial;\n  border-top-style: solid;\n  border-top-width: 2px;\n  border-top-color: #D3D3D3;\n  border-bottom-style: solid;\n  border-bottom-width: 2px;\n  border-bottom-color: #D3D3D3;\n  vertical-align: middle;\n}\n\n#kposcyxavu .gt_from_md > :first-child {\n  margin-top: 0;\n}\n\n#kposcyxavu .gt_from_md > :last-child {\n  margin-bottom: 0;\n}\n\n#kposcyxavu .gt_row {\n  padding-top: 8px;\n  padding-bottom: 8px;\n  padding-left: 5px;\n  padding-right: 5px;\n  margin: 10px;\n  border-top-style: solid;\n  border-top-width: 1px;\n  border-top-color: #D3D3D3;\n  border-left-style: none;\n  border-left-width: 1px;\n  border-left-color: #D3D3D3;\n  border-right-style: none;\n  border-right-width: 1px;\n  border-right-color: #D3D3D3;\n  vertical-align: middle;\n  overflow-x: hidden;\n}\n\n#kposcyxavu .gt_stub {\n  color: #333333;\n  background-color: #FFFFFF;\n  font-size: 100%;\n  font-weight: initial;\n  text-transform: inherit;\n  border-right-style: solid;\n  border-right-width: 2px;\n  border-right-color: #D3D3D3;\n  padding-left: 5px;\n  padding-right: 5px;\n}\n\n#kposcyxavu .gt_stub_row_group {\n  color: #333333;\n  background-color: #FFFFFF;\n  font-size: 100%;\n  font-weight: initial;\n  text-transform: inherit;\n  border-right-style: solid;\n  border-right-width: 2px;\n  border-right-color: #D3D3D3;\n  padding-left: 5px;\n  padding-right: 5px;\n  vertical-align: top;\n}\n\n#kposcyxavu .gt_row_group_first td {\n  border-top-width: 2px;\n}\n\n#kposcyxavu .gt_row_group_first th {\n  border-top-width: 2px;\n}\n\n#kposcyxavu .gt_summary_row {\n  color: #333333;\n  background-color: #FFFFFF;\n  text-transform: inherit;\n  padding-top: 8px;\n  padding-bottom: 8px;\n  padding-left: 5px;\n  padding-right: 5px;\n}\n\n#kposcyxavu .gt_first_summary_row {\n  border-top-style: solid;\n  border-top-color: #D3D3D3;\n}\n\n#kposcyxavu .gt_first_summary_row.thick {\n  border-top-width: 2px;\n}\n\n#kposcyxavu .gt_last_summary_row {\n  padding-top: 8px;\n  padding-bottom: 8px;\n  padding-left: 5px;\n  padding-right: 5px;\n  border-bottom-style: solid;\n  border-bottom-width: 2px;\n  border-bottom-color: #D3D3D3;\n}\n\n#kposcyxavu .gt_grand_summary_row {\n  color: #333333;\n  background-color: #FFFFFF;\n  text-transform: inherit;\n  padding-top: 8px;\n  padding-bottom: 8px;\n  padding-left: 5px;\n  padding-right: 5px;\n}\n\n#kposcyxavu .gt_first_grand_summary_row {\n  padding-top: 8px;\n  padding-bottom: 8px;\n  padding-left: 5px;\n  padding-right: 5px;\n  border-top-style: double;\n  border-top-width: 6px;\n  border-top-color: #D3D3D3;\n}\n\n#kposcyxavu .gt_last_grand_summary_row_top {\n  padding-top: 8px;\n  padding-bottom: 8px;\n  padding-left: 5px;\n  padding-right: 5px;\n  border-bottom-style: double;\n  border-bottom-width: 6px;\n  border-bottom-color: #D3D3D3;\n}\n\n#kposcyxavu .gt_striped {\n  background-color: rgba(128, 128, 128, 0.05);\n}\n\n#kposcyxavu .gt_table_body {\n  border-top-style: solid;\n  border-top-width: 2px;\n  border-top-color: #D3D3D3;\n  border-bottom-style: solid;\n  border-bottom-width: 2px;\n  border-bottom-color: #D3D3D3;\n}\n\n#kposcyxavu .gt_footnotes {\n  color: #333333;\n  background-color: #FFFFFF;\n  border-bottom-style: none;\n  border-bottom-width: 2px;\n  border-bottom-color: #D3D3D3;\n  border-left-style: none;\n  border-left-width: 2px;\n  border-left-color: #D3D3D3;\n  border-right-style: none;\n  border-right-width: 2px;\n  border-right-color: #D3D3D3;\n}\n\n#kposcyxavu .gt_footnote {\n  margin: 0px;\n  font-size: 90%;\n  padding-top: 4px;\n  padding-bottom: 4px;\n  padding-left: 5px;\n  padding-right: 5px;\n}\n\n#kposcyxavu .gt_sourcenotes {\n  color: #333333;\n  background-color: #FFFFFF;\n  border-bottom-style: none;\n  border-bottom-width: 2px;\n  border-bottom-color: #D3D3D3;\n  border-left-style: none;\n  border-left-width: 2px;\n  border-left-color: #D3D3D3;\n  border-right-style: none;\n  border-right-width: 2px;\n  border-right-color: #D3D3D3;\n}\n\n#kposcyxavu .gt_sourcenote {\n  font-size: 90%;\n  padding-top: 4px;\n  padding-bottom: 4px;\n  padding-left: 5px;\n  padding-right: 5px;\n}\n\n#kposcyxavu .gt_left {\n  text-align: left;\n}\n\n#kposcyxavu .gt_center {\n  text-align: center;\n}\n\n#kposcyxavu .gt_right {\n  text-align: right;\n  font-variant-numeric: tabular-nums;\n}\n\n#kposcyxavu .gt_font_normal {\n  font-weight: normal;\n}\n\n#kposcyxavu .gt_font_bold {\n  font-weight: bold;\n}\n\n#kposcyxavu .gt_font_italic {\n  font-style: italic;\n}\n\n#kposcyxavu .gt_super {\n  font-size: 65%;\n}\n\n#kposcyxavu .gt_footnote_marks {\n  font-size: 75%;\n  vertical-align: 0.4em;\n  position: initial;\n}\n\n#kposcyxavu .gt_asterisk {\n  font-size: 100%;\n  vertical-align: 0;\n}\n\n#kposcyxavu .gt_indent_1 {\n  text-indent: 5px;\n}\n\n#kposcyxavu .gt_indent_2 {\n  text-indent: 10px;\n}\n\n#kposcyxavu .gt_indent_3 {\n  text-indent: 15px;\n}\n\n#kposcyxavu .gt_indent_4 {\n  text-indent: 20px;\n}\n\n#kposcyxavu .gt_indent_5 {\n  text-indent: 25px;\n}\n</style>\n<table class=\"gt_table\" data-quarto-disable-processing=\"false\" data-quarto-bootstrap=\"false\">\n  <thead>\n    \n    <tr class=\"gt_col_headings\">\n      <th class=\"gt_col_heading gt_columns_bottom_border gt_center\" rowspan=\"1\" colspan=\"1\" scope=\"col\" id=\"condensed\">condensed</th>\n      <th class=\"gt_col_heading gt_columns_bottom_border gt_right\" rowspan=\"1\" colspan=\"1\" scope=\"col\" id=\"n\">n</th>\n    </tr>\n  </thead>\n  <tbody class=\"gt_table_body\">\n    <tr><td headers=\"condensed\" class=\"gt_row gt_center\">extinct</td>\n<td headers=\"n\" class=\"gt_row gt_right\">1.8</td></tr>\n    <tr><td headers=\"condensed\" class=\"gt_row gt_center\">delisted</td>\n<td headers=\"n\" class=\"gt_row gt_right\">4.2</td></tr>\n    <tr><td headers=\"condensed\" class=\"gt_row gt_center\">endangered</td>\n<td headers=\"n\" class=\"gt_row gt_right\">93.9</td></tr>\n    <tr><td headers=\"condensed\" class=\"gt_row gt_center\">Revision of listed entity</td>\n<td headers=\"n\" class=\"gt_row gt_right\">0.1</td></tr>\n  </tbody>\n  \n  \n</table>\n</div>\n```\n:::\n\n```{.r .cell-code}\n#Values below 1 won't show in a waffle graph anyway, so remove them.\nprogress_percent <- progress_percent %>%\n  filter(n >= 1)\n```\n:::\n\n\nThe waffle package won't work with dataframes for me, so make it a vector.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nprogress_vec = deframe(progress_percent)\n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nwaffle::waffle(progress_vec, colors = c(\"black\", \"darkgreen\", \"darkred\"),\n               title = \"How has the US done with our Endangered species?\",\n               xlab = \"1 square = 1%\") \n```\n\n::: {.cell-output-display}\n![](day4_files/figure-html/waffle_chart-1.png){width=672}\n:::\n:::\n",
    "supporting": [
      "day4_files"
    ],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}